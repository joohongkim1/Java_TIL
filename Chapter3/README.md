### Chapter 3. 상속과 다형성



#### 1. 상속이란?

1) 상속

- 새로운 클래스를 정의 할 때 이미 구현된 클래스를 상속 받아서 속성이나 기능이 확장되는 클래스를 구현

- 상위 클래스 : parent, base, super class

- 하위 클래스 : child, derived, sub class

  ```java
  class B extends A{}
  ```

- 다중 상속 불가능(single inheritance)

- 하위 클래스는 상위 클래스보다 구체적인 개념과 기능을 가짐

2) proteced 예약어

- 외부 클래스에는 private 으로 하위 클래스에서는 public 의 기능을 구현.
- 다른 외부 클래스에서는 사용 불가능하지만 하위 클래스에서는 사용이 가능하다.



**접근 제한자**

|           | 외부 클래스 | 하위 클래스 | 동일 패키지 | 내부 클래스 |
| --------- | ----------- | ----------- | ----------- | ----------- |
| public    | O           | O           | O           | O           |
| protected | X           | O           | O           | O           |
| default   | X           | X           | O           | O           |
| private   | X           | X           | X           | O           |



#### 2. 상속에서 클래스 생성 과정과 형 변환

1) 하위 클래스가 생성되는 과정

- 하위 클래스 생성 시 상위 클래스가 먼저 생성 됨
- 상위 클래스의 생성자가 호출되고 하위 클래스의 생성자가 호출 됨
- 하위 클래스의 생성자에서는 무조건 상위 클래스의 생성자가 호출되어야 함
- 하위 클래스에서 상위 클래스의 생성자를 호출하는 코드가 없는 경우 컴파일러는 상위 클래스 기본 생성자를 호출하기 위한 super() 를 추가함
- 상위 클래스의 기본 생성자가 없는 경우 하위 클래스는 명시적으로 상위 클래스의 생성자를 호출해야 함

2) 상속에서의 메모리 상태

- 상위 클래스의 인스턴스가 먼저 생성이 되고, 하위 클래스의 인스턴스가 생성 됨

3) 상위 클래스로의 묵시적 형 변환(업캐스팅)

- 상위 클래스 형으로 변수를 선언하고 하위 클래스 인스턴스를 생성 할 수 있음

- 상속관계에서 모든 하위 클래스는 상위 클래스로 묵시적 형 변환이 가능(역은 성립하지 않음)

- 클래스 계층 구조가 여러 단계인 경우에도 가능

  ```java
  // 선언된 클래스형(상위 클래스형)
  Customer vc = new VipCustomer();
  				 // 생성된 인스턴스의 클래스형(하위 클래스형)
  ```

  `VIPCustomer() 생성자의 호출로 인스턴스는 모두 생성 되었지만, vc 변수 타입이 Customer 이기 때문에 접근 할 수 있는 변수나 메서드는 Customer 의 변수와 메서드만 가능`



#### 3. 메서드 오버라이딩

1) 오버라이딩

- 상위 클래스에 정의된 메서드의 구현 내용이 하위 클래스에서 구현할 내용과 맞지 않는 경우 하위 클래스에서 동일한 이름의 메서드를 재정의 할 수 있음(선언부는 동일)
- 오버로딩은 메서드 이름은 같지만 매개 변수나 리턴 타입 등이 다른 것.

| 어노테이션           |                          설명                           |
| :------------------- | :-----------------------------------------------------: |
| @Override            |              재정의된 메서드라는 정보 제공              |
| @FunctionalInterface |             함수형 인터페이스라는 정보 제공             |
| @Deprecated          | 이후 버전에서 사용되지 않을 수 있는 변수, 메서드에 사용 |
| @SuppressWarnings    |             특정 경고가 나타나지 않도록 함              |



2) 형 변환과 오버라이딩 메서드 호출

```java
Customer vc = new VipCustomer();
vc.calcPrice(10000);

// 위 코드에서 calcPrice() 메서드는 VipCustomer 의 메서드가 호출된다.
// 자바에서는 항상 인스턴스(여기서는 VipCustomer) 의 메서드가 호출된다.
```



3) 가상 메서드

- 메서드의 이름과 메서드 주소를 가진 가상 메서드 테이블에서 호출될 메서드의 주소를 참조함

-- Customer 클래스의 가상 메서드 테이블

| 메서드                            | 메서드 주소 |
| --------------------------------- | ----------- |
| calcPrice(재정의됨)               | 0XFF00FFAA  |
| showCustomerInfo(재정의되지 않음) | 0x112233AA  |

-- VipCustomer 클래스의 가상 메서드 테이블

| 메서드                            | 메서드 주소 |
| --------------------------------- | ----------- |
| calcPrice(재정의됨)               | 0x00335577  |
| showCustomerInfo(재정의되지 않음) | 0x112233AA  |

--> calcPrice 메서드의 주소가 서로 다르다.



#### 4. 다형성(polymorphism)

1) 다형성이란?

- 하나의 코드가 여러 자료형으로 구현되어 실행되는 것
- 같은 코드에서 여러 실행 결과가 나옴
- 정보은닉, 상속과 더불어 객체지향 프로그래밍의 가장 큰 특징 중 하나
- OOP 의 유연성, 재활용성, 유지보수성의 기본이 되는 특징

2) 다형성의 장점

- 다양한 여러 클래스를 하나의 자료형(상위 클래스)으로 선언하거나 형변환 하여 각 클래스가 동일한 메서드를 오버라이딩 한 경우, 하나의 코드가 다양한 구현을 실행 할 수 있음
- 유사한 클래스가 추가되는 경우 유지보수에 용이하고, 각 자료형마다 다른 메서드를 호출하지 않으므로 코드에서 많은 if 문이 사라짐

3) 상속은 언제 사용할까?

- IS-A 관계(is a relationship : inheritance)
  - 일반적 개념과 구체적 개념의 관계 ex) 상위 : 포유류, 하위 : 사람, 원숭이, 호랑이 등
  - 단순히 코드를 재사용하는 목적으로 사용하지 않음
- HAS-A 관계(composition)
  - 한 클래스가 다른 클래스를 소유한 관계
  - ex) Student 가 Subject 를 포함한 관계



#### 5. 다운 캐스팅과 instanceof

1) 하위 클래스로 형 변환, 다운 캐스팅

- 묵시적으로 상위 클래스 형 변환된 인스턴스가 원래 자료형(하위 클래스)으로 변환되어야 할 때 다운 캐스팅

- 다운 캐스팅은 업 캐스팅과 달리 명시적으로 되어야 함.

  ```java
  Customer vc = new VipCustomer(); // 묵시적
  VipCustomer vCustomer = (VipCustomer)vc; // 명시적
  ```

- 오버라이딩이 불가능한 경우 사용

